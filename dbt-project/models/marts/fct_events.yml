
version: 2

models:

  - name: fct_events
    description: >
      Fact table for user events. Extracted from staging events data.

    config:
      contract:
        enforced: false

    columns:
      - name: event_id
        data_type: string
        constraints:
          - type: primary_key
          - type: not_null
        description: "Unique identifier for the event"
        tests:
          - not_null
          - unique

      - name: event_time
        data_type: timestamp
        constraints:
          - type: not_null
        description: "Timestamp when the event occurred"
        tests:
          - not_null

      - name: event_date
        data_type: date
        constraints:
          - type: not_null
        description: "Date when the event occurred"
        tests:
          - not_null

      - name: event_type
        data_type: string
        constraints:
          - type: not_null
        description: "Type of the event (e.g., view, click, purchase)"
        tests:
          - not_null

      - name: user_id
        data_type: string
        constraints:
          - type: not_null
        description: "Identifier for the user who generated the event"
        tests:
          - not_null

      - name: user_session
        data_type: string
        constraints:
          - type: not_null
        description: "Identifier for the session during which the event occurred"
        tests:
          - not_null

      - name: product_id
        data_type: string
        description: "Identifier for the product associated with the event (if applicable)"

      - name: category_code
        data_type: string
        description: "Category code associated with the product (if applicable)"

      - name: category_id
        data_type: string
        description: "Category id associated with the product (if applicable)"

      - name: brand
        data_type: string
        description: "Brand of the product associated with the event (if applicable)"

      - name: price
        data_type: float
        description: "Price of the product associated with the event (if applicable)"

      - name: quantity
        data_type: integer
        description: "Quantity of the product involved in the event (set to 1 for downstream aggregations)"

      - name: is_purchase
        data_type: integer
        constraints:
          - type: not_null
        description: "Indicator if the event is a purchase event (1 for purchase, 0 otherwise)"
        tests:
          - not_null

      - name: is_cart_add
        data_type: integer
        constraints:
          - type: not_null
        description: "Indicator if the event is an add-to-cart event (1 for add-to-cart, 0 otherwise)"
        tests:
          - not_null

      - name: is_view
        data_type: integer
        constraints:
          - type: not_null
        description: "Indicator if the event is a view event (1 for view, 0 otherwise)"
        tests:
          - not_null
      
      - name: revenue
        data_type: float
        description: "Revenue generated from the event (price * quantity for purchase events, 0 otherwise)"
        tests:
          - assert_non_negative
