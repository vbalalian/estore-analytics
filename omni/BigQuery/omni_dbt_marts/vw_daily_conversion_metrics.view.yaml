# Reference this view as omni_dbt_marts__vw_daily_conversion_metrics
schema_label: ""
#This description was pulled from dbt.
description: Daily conversion funnel metrics filtered from
  metrics_conversion_rates. Provides a simplified view for Tableau dashboards.

schema: omni_dbt_marts
table_name: vw_daily_conversion_metrics

dimensions:
  metric_date:
    #This description was pulled from dbt.
    description: The date for which the metrics are calculated.

  total_sessions:
    #This description was pulled from dbt.
    description: Total number of sessions on this date.

  sessions_with_view:
    #This description was pulled from dbt.
    description: Number of sessions that included at least one product view.

  sessions_with_cart:
    #This description was pulled from dbt.
    description: Number of sessions that included at least one add-to-cart event.

  sessions_with_purchase:
    #This description was pulled from dbt.
    description: Number of sessions that included at least one purchase.

  view_to_cart_rate:
    #This description was pulled from dbt.
    description: Conversion rate from view to cart (sessions_with_cart /
      sessions_with_view).

  cart_to_purchase_rate:
    #This description was pulled from dbt.
    description: Conversion rate from cart to purchase (sessions_with_purchase /
      sessions_with_cart).

  view_to_purchase_rate:
    #This description was pulled from dbt.
    description: Overall conversion rate from view to purchase
      (sessions_with_purchase / sessions_with_view).

  avg_order_value:
    #This description was pulled from dbt.
    description: Average order value for purchase sessions on this date.

measures:
  count:
    aggregate_type: count

#The info below was pulled from your dbt repository and is read-only.
dbt:
  name: vw_daily_conversion_metrics
  target_schema: estore
  description: Daily conversion funnel metrics filtered from
    metrics_conversion_rates. Provides a simplified view for Tableau dashboards.
  config:
    schema: marts
    materialized: view
  code: |-
    {{ config(materialized='view') }}

    with

    conversion_metrics as (

        select * from {{ ref('metrics_conversion_rates') }}

    ),

    daily_conversion_metrics as (

        select

            total_sessions,
            sessions_with_view,
            sessions_with_cart,
            sessions_with_purchase,
            view_to_cart_rate,
            cart_to_purchase_rate,
            view_to_purchase_rate,
            avg_order_value,
            date(time_period) as metric_date

        from conversion_metrics

        where metric_level = 'daily'

    ),

    final as (

        select

            metric_date,
            total_sessions,
            sessions_with_view,
            sessions_with_cart,
            sessions_with_purchase,
            view_to_cart_rate,
            cart_to_purchase_rate,
            view_to_purchase_rate,
            avg_order_value

        from daily_conversion_metrics

    )

    select * from final
